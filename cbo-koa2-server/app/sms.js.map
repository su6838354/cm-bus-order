{"version":3,"sources":["../src/sms.js"],"names":["http","require","urlencode","account","password","sms_host","phone","msg","send_sms_uri","query_balance_uri","querystring","fs","PostCode","uri","params","post_data","stringify","post_options","host","port","path","method","headers","Buffer","byteLength","post_req","request","res","setEncoding","on","chunk","console","log","write","end","send_sms","query_blance","content","post","options","hostname","req","statusCode","codes","sendSms","code","Math","floor","random","checkOk"],"mappings":"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","file":"sms.js","sourcesContent":["﻿var http = require('http');\r\nvar urlencode = require('urlencode');\r\n\r\n//参数的配置 请登录zz.253.com 获取以下API信息 ↓↓↓↓↓↓↓\r\n// API账号\r\nvar account=\"shoukaihu8\";\r\n// API密码\r\nvar password=\"Dengmixx253\";\r\n//接口域名\r\nvar sms_host = 'sapi.253.com';\r\n\r\n//手机号码\r\nvar phone=\"\";\r\n\r\n// 设置您要发送的内容：其中“【】”中括号为运营商签名符号，多签名内容前置添加提交\r\n\r\nvar msg=\"【趣游崇明】您的登录验证码为: 4472, 请注意保密, 十五分钟内有效。\";\r\n\r\n\r\n\r\n// 普通短信发送URL\r\nvar send_sms_uri = '/msg/HttpBatchSendSM';\r\n\r\n//余额查询的URL\r\nvar query_balance_uri = '/msg/balance/json';\r\n\r\n// send_sms(send_sms_uri,account,password,phone,msg);\r\n\r\n// query_blance(query_balance_uri,account,password);\r\n\r\nvar querystring = require('querystring');\r\nvar http = require('http');\r\nvar fs = require('fs');\r\n\r\nfunction PostCode(uri, params) {\r\n    // Build the post string from an object\r\n    var post_data = querystring.stringify(params);\r\n\r\n    // An object of options to indicate where to post to\r\n    var post_options = {\r\n        host: sms_host,\r\n        port: '80',\r\n        path: uri,\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n            'Content-Length': Buffer.byteLength(post_data)\r\n        }\r\n    };\r\n\r\n    // Set up the request\r\n    var post_req = http.request(post_options, function(res) {\r\n        res.setEncoding('utf8');\r\n        res.on('data', function (chunk) {\r\n            console.log('Response: ' + chunk);\r\n        });\r\n    });\r\n\r\n    // post the data\r\n    post_req.write(post_data);\r\n    post_req.end();\r\n\r\n}\r\n\r\n// 发送短信方法\r\nfunction send_sms(uri,account,password,phone,msg){\r\n\r\n    var post_data = { // 这是需要提交的数据 \r\n        'account': account,\r\n        'pswd': password,\r\n        'mobile':phone,\r\n        'msg':msg,\r\n        'needstatus': 'false', 'extno' : '',\r\n\r\n    };\r\n    console.log(uri);\r\n    PostCode(uri, post_data)\r\n\r\n    // var content =  JSON.stringify(post_data);\r\n    // content = urlencode.stringify(post_data);\r\n    // // headers = {\"Content-type\": \"application/x-www-form-urlencoded\", \"Accept\": \"text/plain\"}\r\n    // post(uri,content,sms_host);\r\n\t\r\n}\r\n  \r\n// 查询余额方法\r\nfunction query_blance(uri,content,host){\r\n\t\r\n    var post_data = { // 这是需要提交的数据 \r\n    'account': account,   \r\n    'password': password, \r\n    };  \r\n    var content = JSON.stringify(post_data);  \r\n    post(uri,content,sms_host);\r\n}\r\n  \r\nfunction post(uri,content,host){\r\n\tvar options = {  \r\n        hostname: host,\r\n        port: 80,  \r\n        path: uri,  \r\n        method: 'POST',  \r\n        headers: {  \r\n            'Content-Type': 'application/json; charset=UTF-8', \r\n        }  \r\n    };\r\n    var req = http.request(options, function (res) {  \r\n        console.log('STATUS: ' + res.statusCode);  \r\n        \r\n        res.setEncoding('utf8');  \r\n        res.on('data', function (chunk) {  \r\n            console.log('BODY: ' + chunk);  \r\n        });  \r\n    }); \r\n   \r\n    req.write(content);  \r\n  \r\n    req.end();   \r\n} \r\n\r\n\r\nconst codes = {\r\n\r\n}\r\n\r\nfunction sendSms(phone) {\r\n    const code = Math.floor(Math.random() * 1000);\r\n    codes[phone] = `3${code}`;\r\n    var msg=`您的登录验证码为: 3${code}, 请注意保密, 十五分钟内有效。`;\r\n    console.log( phone, msg);\r\n    send_sms(send_sms_uri,account,password,phone,msg);\r\n}\r\n\r\n// sendSms('13636672480');\r\n\r\nfunction checkOk(phone, code) {\r\n    if (codes[phone] && codes[phone] == code) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\nexport default {\r\n    sendSms,\r\n    checkOk,\r\n}\r\n"]}